<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.8/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="math.min.js"></script>
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-68503719-1', 'auto');
    ga('send', 'pageview');
    </script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.8/css/jquery.dataTables.min.css">
    <style>
    body {
        text-align: center;
    }
    
    .value {
        margin: auto;
    }
    
    .header {
        font-weight: bold;
        font-style: 20px;
        margin-bottom: 10px;
    }
    
    #main-nav {
        width: 100%;
        margin-bottom: 25px;
        position: fixed;
        top: 0;
        z-index: 1000;
    }
    
    .main-nav-flex {
        display: flex;
        display: -webkit-flex;
    }
    
    .main-nav-flex a {
        padding: 15px;
        flex: 1 0 0;
        -webkit-flex: 1 0 0;
        background-color: #848484;
        color: white;
        font-size: 20px;
        text-decoration: none;
    }
    
    .main-nav-flex a:hover {
        background-color: #bcbcbc;
    }
    
    h1, h2 {
        padding-top: 50px;
    }
    
    #table-container {
        padding: 0 10px;
    }
    </style>
</head>

<body>
    <div id="main-nav">
        <div class="main-nav-flex">
            <a href="#quarterbacks" style="border-right:1px solid #bcbcbc">
                <div class="nav-link">Quarterbacks</div>
            </a>
            <a href="#widereceivers" style="border-right:1px solid #bcbcbc">
                <div class="nav-link">Wide Receivers</div>
            </a>
            <a href="#runningbacks" style="border-right:1px solid #bcbcbc">
                <div class="nav-link">Running Backs</div>
            </a>
            <a href="#tightends" style="border-right:1px solid #bcbcbc">
                <div class="nav-link">Tight Ends</div>
            </a>
            <a href="#defense">
                <div class="nav-link">Defense</div>
            </a>
        </div>
    </div>
    <div id="table-container">
        <h1>FanDuel</h1>
        <p><strong>StDev:</strong> Standard deviations above the mean for position (higher better)</p>
        <p><strong>Value:</strong> Standard deviation divided by salary (higher better)</p>
        <p><strong>Avg Dollars per Point: </strong> The number of dollars it costs to get a point on average (lower better)</p>
        <h2 id="quarterbacks" style="padding-top: 25px;">Quarterbacks</h2>
        <table id="qb-table" class="dt-table display responsive" style="width:100%">
            <thead>
                <td>Name</td>
                <td>Salary</td>
                <td>GameInfo</td>
                <td>Avg Points Per Game</td>
                <td>StDev</td>
                <td>Value</td>
                <td>Avg Dollars per Point</td>
            </thead>
        </table>
        <h2 id="widereceivers">Wide Receivers</h2>
        <table id="wr-table" class="dt-table display responsive" style="width:100%">
            <thead>
                <td>Name</td>
                <td>Salary</td>
                <td>GameInfo</td>
                <td>Avg Points Per Game</td>
                <td>StDev</td>
                <td>Value</td>
                <td>Avg Dollars per Point</td>
            </thead>
        </table>
        <h2 id="runningbacks">Running Backs</h2>
        <table id="rb-table" class="dt-table display responsive" style="width:100%">
            <thead>
                <td>Name</td>
                <td>Salary</td>
                <td>GameInfo</td>
                <td>Avg Points Per Game</td>
                <td>StDev</td>
                <td>Value</td>
                <td>Avg Dollars per Point</td>
            </thead>
        </table>
        <h2 id="tightends">Tight Ends</h2>
        <table id="te-table" class="dt-table display responsive" style="width:100%">
            <thead>
                <td>Name</td>
                <td>Salary</td>
                <td>GameInfo</td>
                <td>Avg Points Per Game</td>
                <td>StDev</td>
                <td>Value</td>
                <td>Avg Dollars per Point</td>
            </thead>
        </table>
        <h2 id="defense">Defense</h2>
        <table id="def-table" class="dt-table display responsive" style="width:100%">
            <thead>
                <td>Name</td>
                <td>Salary</td>
                <td>GameInfo</td>
                <td>Avg Points Per Game</td>
                <td>StDev</td>
                <td>Value</td>
                <td>Avg Dollars per Point</td>
            </thead>
        </table>
    </div>
    <script>
    var qbTable;
    var qbArray;
    $(document).ready(function() {
        //Begin Datatables Initializing
        $.fn.dataTable.defaults.column.asSorting = ['desc', 'asc'];

        var teTable = $('#te-table').DataTable({
            paging: false,
            info: false,
            order: [
                [5, "desc"]
            ],
            aaSorting: [
                [4, 'asc']
            ],
            columnDefs: [{
                type: "num",
                targets: 6
            }, {
                orderSequence: ["asc"],
                targets: 6
            }],
            language: {
                emptyTable: "Loading...",
                search: "Filter:"
            }

        });

        var rbTable = $('#rb-table').DataTable({
            paging: false,
            info: false,
            order: [
                [5, "desc"]
            ],
            aaSorting: [
                [4, 'asc']
            ],
            columnDefs: [{
                type: "num",
                targets: 6
            }, {
                orderSequence: ["asc"],
                targets: 6
            }],
            language: {
                emptyTable: "Loading...",
                search: "Filter:"
            }

        });

        var wrTable = $('#wr-table').DataTable({
            paging: false,
            info: false,
            order: [
                [5, "desc"]
            ],
            aaSorting: [
                [4, 'asc']
            ],
            columnDefs: [{
                type: "num",
                targets: 6
            }, {
                orderSequence: ["asc"],
                targets: 6
            }],
            language: {
                emptyTable: "Loading...",
                search: "Filter:"
            }

        });

        var defTable = $('#def-table').DataTable({
            paging: false,
            info: false,
            order: [
                [5, "desc"]
            ],
            aaSorting: [
                [4, 'asc']
            ],
            columnDefs: [{
                type: "num",
                targets: 6
            }, {
                orderSequence: ["asc"],
                targets: 6
            }],
            language: {
                emptyTable: "Loading...",
                search: "Filter:"
            }

        });

        qbTable = $('#qb-table').DataTable({
            paging: false,
            info: false,
            order: [
                [5, "desc"]
            ],
            aaSorting: [
                [4, 'asc']
            ],
            columnDefs: [{
                type: "num",
                targets: 6
            }, {
                orderSequence: ["asc"],
                targets: 6
            }],
            language: {
                emptyTable: "Loading...",
                search: "Filter:"
            }
        });

        //End Datatables

        var fanduelJson;

        //Grab the data.json file
        $.getJSON('data.json', function(data) {
            fanduelJson = data;
        }).done(function() {
            for (var i = 1; i < fanduelJson.length; i++) {
                switch (fanduelJson[i].Position) {
                    case "QB":
                        qbTable.row.add([
                            fanduelJson[i]['Last Name'] + ", " + fanduelJson[i]['First Name'],
                            "$" + fanduelJson[i]['Salary'],
                            fanduelJson[i]['Game'],
                            fanduelJson[i]['FPPG'],
                            fanduelJson[i]['Last Name'],
                            fanduelJson[i]['Last Name'],
                            ""
                        ]).draw();
                        break;

                    case "RB":
                        rbTable.row.add([
                            fanduelJson[i]['Last Name'] + ", " + fanduelJson[i]['First Name'],
                            "$" + fanduelJson[i]['Salary'],
                            fanduelJson[i]['Game'],
                            fanduelJson[i]['FPPG'],
                            fanduelJson[i]['Last Name'],
                            fanduelJson[i]['Last Name'],
                            ""
                        ]).draw();
                        break;

                    case "WR":
                        wrTable.row.add([
                            fanduelJson[i]['Last Name'] + ", " + fanduelJson[i]['First Name'],
                            "$" + fanduelJson[i]['Salary'],
                            fanduelJson[i]['Game'],
                            fanduelJson[i]['FPPG'],
                            fanduelJson[i]['Last Name'],
                            fanduelJson[i]['Last Name'],
                            ""
                        ]).draw();
                        break;

                    case "TE":
                        teTable.row.add([
                            fanduelJson[i]['Last Name'] + ", " + fanduelJson[i]['First Name'],
                            "$" + fanduelJson[i]['Salary'],
                            fanduelJson[i]['Game'],
                            fanduelJson[i]['FPPG'],
                            fanduelJson[i]['Last Name'],
                            fanduelJson[i]['Last Name'],
                            ""
                        ]).draw();
                        break;

                    case "D":
                        defTable.row.add([
                            fanduelJson[i]['First Name'] + " " + fanduelJson[i]['Last Name'],
                            "$" + fanduelJson[i]['Salary'],
                            fanduelJson[i]['Game'],
                            fanduelJson[i]['FPPG'],
                            fanduelJson[i]['Last Name'],
                            fanduelJson[i]['Last Name'],
                            ""
                        ]).draw();
                        break;
                }

                if (i === (fanduelJson.length - 1)) {

                    //Initialize variables
                    qbArray = qbTable.columns(3).data()[0];
                    var qbArrayLength = qbArray.length;
                    var qbStDev = 0;
                    var qbAvg = 0;

                    rbArray = rbTable.columns(3).data()[0];
                    var rbArrayLength = rbArray.length;
                    var rbStDev = 0;
                    var rbAvg = 0;

                    wrArray = wrTable.columns(3).data()[0];
                    var wrArrayLength = wrArray.length;
                    var wrStDev = 0;
                    var wrAvg = 0;

                    teArray = teTable.columns(3).data()[0];
                    var teArrayLength = teArray.length;
                    var teStDev = 0;
                    var teAvg = 0;

                    defArray = defTable.columns(3).data()[0];
                    var defArrayLength = defArray.length;
                    var defStDev = 0;
                    var defAvg = 0;

                    //remove $ from beginning of dataset
                    removeDollar(qbArray, qbTable);
                    removeDollar(rbArray, rbTable);
                    removeDollar(wrArray, wrTable);
                    removeDollar(teArray, teTable);
                    removeDollar(defArray, defTable);

                    //Calc the stDev and avg for data sets
                    qbStDev = math.std(qbArray);
                    qbAvg = math.mean(qbArray);

                    rbStDev = math.std(rbArray);
                    rbAvg = math.mean(rbArray);

                    wrStDev = math.std(wrArray);
                    wrAvg = math.mean(wrArray);

                    teStDev = math.std(teArray);
                    teAvg = math.mean(teArray);

                    defStDev = math.std(defArray);
                    defAvg = math.mean(defArray);

                    //Calculate the values for last few columns
                    calcValues(qbTable, qbStDev, qbAvg);
                    calcValues(rbTable, rbStDev, rbAvg);
                    calcValues(wrTable, wrStDev, wrAvg);
                    calcValues(teTable, teStDev, teAvg);
                    calcValues(defTable, defStDev, defAvg);
                }
            }
        })


    });

    function removeDollar(dataArray, table) {
        for (var k = 1; k < dataArray.length; k++) {
            table.cell(k, 4).data(dataArray[k]);
            if (dataArray[k] === "0") {
                dataArray.splice(k, 1);
                k = k - 1;
            }
        }
    }

    function calcValues(table, stDev, avg) {
        table.rows().every(function(rowIdx, tableLoop, rowLoop) {
            var d = this.data();
            var salary = d[1].slice(1)

            d[4] = ((d[3] - avg) / stDev).toFixed(2); //creating the stDev value
            d[5] = (d[4] / (salary / 10000)).toFixed(2);
            //If the avg is > than 0
            if (d[3] > 0) {
                d[6] = (salary / d[3]).toFixed(2);
            } else {
                d[6] = "N/A";
            }

            this.invalidate(); // invalidate the data DataTables has cached for this row
        });

        table.draw();
    }
    </script>
</body>

</html>
